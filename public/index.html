<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Break Time</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <style>
            svg{
                width: 70%;
                height: 100%;
            }
            .loading{
                width: 40px ;
            }
            .circle{
                position: relative;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                height: 200px;
                width: 200px;
                background: #fff;
                border-radius: 50%;
            }
            .break-in{
                background: #070000;
            }
            #time_consume{
                font-size: 120px;
            }
            .card{
                background-color: #f0f0ff !important;
            }
            /* width */
            ::-webkit-scrollbar {
            width: 2px;
            }

            /* Track */
            ::-webkit-scrollbar-track {
            background: #f1f1f1; 
            }
            
            /* Handle */
            ::-webkit-scrollbar-thumb {
            background: #888; 
            }

            /* Handle on hover */
            ::-webkit-scrollbar-thumb:hover {
            background: #555; 
            }
        </style>
    </head>
    <body style="height:100vh;width:100%;">

    <div class="row p-0 m-0">
        <div class="col-lg-6" style="height: 100vh;background: #f0f0ff;">
            <div class="card my-4 bg-transparent w-100 border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="circle shadow-lg">
                            <h1 class="text-secondary font-weight-bold" id="time_consume">0</h1>
                            <h4 style="color: #b9b9b9;display: none;" id="time_text"></h3>
                        </div>
                    </div>
                    <h5 class="card-title my-2 text-center" style="color: #b9b9b9;font-weight: 200;" id="current_time">Loading....</h5>
                    <center><a href="#" class="text-center btn btn-sm btn-danger" onclick="reset()">Reset</a></center>
                    <hr>
                    <div class="w-100 my-4">
                        <input type="button" class="btn btn-secondary btn-block font-weight-bold btn-lg shadow-sm" value="Break Out" id="break">
                    </div>
                    <div class="my-4">
                        <div class="row">
                            <div class="col-lg-4 d-flex flex-column align-items-center text-center">
                                <div class="card border-0 shadow-lg w-100">
                                    <div class="card-body">
                                        <h5 style="color: #242424;font-weight: normal;">Break Time Start</h5>
                                        <h1 class="text-dark" id="break_time_start">00:00 --</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 d-flex flex-column align-items-center text-center">
                                <div class="card border-0 shadow-lg w-100">
                                    <div class="card-body">
                                        <h5 style="color: #242424;font-weight: normal;">Break Out</h5>
                                        <h1 class="text-dark" id="break_out">00:00 --</h1>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 d-flex flex-column align-items-center text-center">
                                <div class="card border-0 shadow-lg w-100">
                                    <div class="card-body">
                                        <h5 style="color: #242424;font-weight: normal;">Break In</h5>
                                        <h1 class="text-dark" id="break_in">00:00 --</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card shadow-lg my-4" style="display: none;" id="bt">
                            <div class="card-header font-weight-bold">Break Shiit Data</div>
                            <div class="card-body position-relative p-0" style="max-height: 310px;overflow: auto;">
                                <table class="table">
                                    <thead class="sticky-top p-0" style="background-color: #e0e0ee;">
                                      <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Break Out</th>
                                        <th scope="col">Break In</th>
                                        <th scope="col">Break Total</th>
                                      </tr>
                                    </thead>
                                    <tbody id="dataBreaks">
                                      
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 bg-white d-flex p-0" style="height: 100vh;">
            <img id="image" alt="awd" class="img-fluid" src="./working.gif">
        </div>
    </div>
    
        <script src="./lib/moment/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/1.3.0/moment-duration-format.min.js"></script>
        <script>
            const current_time_output = document.getElementById('current_time') // current time element
            const time_consume = document.getElementById('time_consume') // current time element
            const monitor_output = document.getElementById('monitor') // monitor element
            const break_time_start = document.getElementById('break_time_start') // time start
            const break_out = document.getElementById('break_out') // out
            const break_in = document.getElementById('break_in') // in
            const time_text = document.getElementById('time_text') // in
            // const breakStatus = document.getElementById('status') // in
            let breakButton = document.getElementById('break') // break button

            // ---------- interval -------------
            setInterval(()=>{
                current_time_output.innerHTML = moment().format("MMMM D YYYY, dddd, h:mm:ss A");
            }, 1000)

            // ---------- break event -------------
            breakButton.addEventListener('click', ()=>{
                const storage = localStorage.getItem("breaktimeStorage");
                const storage2 = localStorage.getItem("totalBreakStorage");
                const breakStorage = JSON.parse(storage)
                const breakStorage2 = JSON.parse(storage2)
                if(breakButton.classList.contains('break-in')){
                    const breakInData = {
                        breakStart: breakStorage.breakStart,
                        breakEnd: moment(),
                        event: "In",
                    };

                    var tableData = JSON.parse(localStorage.getItem('dataTable')) || [];

                    const dataToPush = {
                        in: breakStorage.breakStart,
                        out: moment()
                    }
                    tableData.push(dataToPush);
                    localStorage.setItem("dataTable", JSON.stringify(tableData));
                    
                    localStorage.setItem("breaktimeStorage", JSON.stringify(breakInData));
                    breakData()
                    CopyToClipboard('break_in')
                }else{
                    const breakOutData = {
                        breakStart: moment(),
                        breakEnd: "Ongoing",
                        event: "Out",
                    };
                    localStorage.setItem("breaktimeStorage", JSON.stringify(breakOutData));

                    if (breakStorage2 != null && breakStorage2.breakTimeStart != null) {
                        var totalBreakData = {
                            breakTimeStart: breakStorage2.breakTimeStart
                        };
                    }else{
                        var totalBreakData = {
                            breakTimeStart: moment(),
                        };
                    }
                    localStorage.setItem("totalBreakStorage", JSON.stringify(totalBreakData));
                    breakData()
                    CopyToClipboard('break_out')
                }
                
            })

            function CopyToClipboard(containerid) {
                if (document.selection) {
                    var range = document.body.createTextRange();
                    range.moveToElementText(document.getElementById(containerid));
                    range.select().createTextRange();
                    document.execCommand("copy");
                } else if (window.getSelection) {
                    var range = document.createRange();
                    range.selectNode(document.getElementById(containerid));
                    window.getSelection().addRange(range);
                    document.execCommand("copy");
                    location.reload();
                }
            }
            
            // ---------- get breaktime data -------------
            const breakData = ()=>{
                const storage = localStorage.getItem("breaktimeStorage");
                const storage2 = localStorage.getItem("totalBreakStorage");
                const storage3 = localStorage.getItem("total");
                const breakStorage = JSON.parse(storage)
                const breakStorage2 = JSON.parse(storage2)
                const breakStorage3 = JSON.parse(storage3)
                if(storage != null){
                    if(breakStorage.event == 'Out'){
                        breakButton.value = "Break In";
                        breakButton.classList.add('break-in')
                        // breakStatus.innerHTML = "On Break";
                        document.getElementById('image').src = './tenor.gif';
                    }else{
                        // breakStatus.innerHTML = "Working";
                        if(breakButton.value != 'Break Out'){
                            breakButton.value = "Break Out";
                            breakButton.classList.remove('break-in')
                            var b_out = moment(breakStorage.breakStart)
                            var b_in = moment(breakStorage.breakEnd)
                            var b_seconds = b_in.diff(b_out, 'seconds')
                            if(breakStorage3 == null){
                                var total = {
                                    total: b_seconds
                                };
                            }else{
                                var total = {
                                    total: parseInt(breakStorage3.total) + parseInt(b_seconds) 
                                };
                            }
                            localStorage.setItem("total", JSON.stringify(total));
                        }
                    }
                }else{
                    // monitor_output.style.fill = "white"
                }

                if (breakStorage2 != null) {
                    break_time_start.innerHTML = moment(breakStorage2.breakTimeStart).format("h:mm:ss A")
                    // break_out.innerHTML = moment(breakStorage.breakStart).format("h:mm:ss A")
                    break_out.innerHTML = 'Break' + ' ' + moment(breakStorage.breakStart).format("h:mm")
                    if(breakStorage.breakEnd == 'Ongoing'){
                        break_in.innerHTML = "Ongoing";
                        const getstorage3 = localStorage.getItem("total");
                        const getbreakStorage3 = JSON.parse(getstorage3)
                        let sec = parseInt(getbreakStorage3.total)

                        var duration = moment.duration(sec, 'seconds');
                        var formatted = duration.format("hh:mm:ss", { trim: false });
                        var computed = formatted.split(':')

                        if(computed[0] == '00' && computed[1] != '00'){
                            var computedTime = computed[1]
                            var tt = 'mins'
                            time_text.style.display = 'block'
                        }else if(computed[1] == '00' && computed[0] == '00'){
                            var computedTime = computed[2]
                            var tt = 'sec'
                            time_text.style.display = 'block'
                        }else{
                            var computedTime = computed[0]
                            var tt = 'hour'
                            time_text.style.display = 'block'
                        }

                        time_consume.innerHTML = computedTime
                        time_text.innerHTML = tt
                    }else{
                        break_in.innerHTML = 'In' + ' ' + moment(breakStorage.breakEnd).format("h:mm")

                        const getstorage3 = localStorage.getItem("total");
                        const getbreakStorage3 = JSON.parse(getstorage3)
                        let sec = parseInt(getbreakStorage3.total)

                        var duration = moment.duration(sec, 'seconds');
                        var formatted = duration.format("hh:mm:ss", { trim: false });
                        var computed = formatted.split(':')

                        if(computed[0] == '00' && computed[1] != '00'){
                            var computedTime = computed[1]
                            var tt = 'mins'
                            time_text.style.display = 'block'
                        }else if(computed[1] == '00' && computed[0] == '00'){
                            var computedTime = computed[2]
                            var tt = 'sec'
                            time_text.style.display = 'block'
                        }else{
                            var computedTime = computed[0]
                            var tt = 'hour'
                            time_text.style.display = 'block'
                        }

                        time_consume.innerHTML = computedTime
                        time_text.innerHTML = tt
                    }
                }
            }
            breakData()
            const dataBreaks = document.querySelector('#dataBreaks');
            var testt = JSON.parse(localStorage.getItem('dataTable')) || [];
            if(document.querySelector('#dataBreaks').innerHTML != ''){
                document.querySelector('#bt').style.display = 'block'
            }
            testt.forEach(function(data, index){
                let start = moment(data.in); // some random moment in time (in ms)
                let end = moment(data.out); // some random moment after start (in ms)
                let diff = end.diff(start);

                // execution
                let f = moment.utc(diff).format("HH:mm:ss");
                dataBreaks.innerHTML += `<tr>
                                            <td>${(index == 0 ? 'Start' : index)}</td>
                                            <td>${moment(data.in).format('h:mm:ss')}</td>
                                            <td>${moment(data.out).format('h:mm:ss')}</td>
                                            <td>${f}</td>
                                        </tr>`;
            })

            function reset(){
                localStorage.clear()
                time_consume.innerHTML = '0'
                time_text.style.display = 'none'
                break_time_start.innerHTML = '00:00 --'
                break_out.innerHTML = '00:00 --'
                break_in.innerHTML = '00:00 --'
                document.querySelector('#bt').style.display = 'none'
            }
        </script>
    </body>
</html>